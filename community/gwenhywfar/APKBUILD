# Contributor: Sören Tempel <soeren+alpine@soeren-tempel.net>
maintainer="Sören Tempel <soeren+alpine@soeren-tempel.net>"
pkgname=gwenhywfar
pkgver=5.12.2
pkgrel=0
pkgdesc="Multi-platform helper library"
url="https://www.aquamaniac.de/"
arch="all"
license="LGPL-2.1-or-later"
makedepends="libgcrypt-dev gnutls-dev gettext-dev gtk+3.0-dev"
options="net" # tests send HTTP requests to remote hosts
subpackages="$pkgname-dev $pkgname-doc $pkgname-lang $pkgname-gtk3"
source="https://www.aquamaniac.de/rdm/attachments/download/539/gwenhywfar-$pkgver.tar.gz
	fix-tests.patch"

case "$CARCH" in
arm*|aarch64)
	# these tests seem to require ipv4 networking
	options="$options !check"
	;;
esac

build() {
	export LDFLAGS="$LDFLAGS -lintl"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--localstatedir=/var \
		--with-guis=gtk3 \
		--enable-ssl \
		--enable-visibility
	make
}

check() {
	make check
}

package() {
	make DESTDIR="$pkgdir" install

	mkdir -p "$pkgdir"/usr/share/doc/$pkgname
	install -m644 AUTHORS ChangeLog README TODO \
		"$pkgdir"/usr/share/doc/$pkgname
}

gtk3() {
	amove usr/lib/libgwengui-gtk3.so*
}

sha512sums="
7d74721c9dd6102b28ad8cecf23e515401bb1345bc6c5e5aab94ef976746a0b684201c63b97e383ef0b66d0bc4d144788c7c3d8f6eb5df04790b046167e8d3bd  gwenhywfar-5.12.2.tar.gz
337836a5b6edf1f127768b1654d2e0667d8adc8e02f09a9d7bf0850ecee5fbe2ae544eb6a37436f57708b80c0b919d19f538fda30232ff3ac7c46e448a9adda6  fix-tests.patch
"
