# Maintainer: Celeste <cielesti@protonmail.com>
maintainer="Celeste <cielesti@protonmail.com>"
pkgname=slimcc
pkgver=0_git20250910
_gitrev=764e1d4e51ad51038d71ca17fc9f1a8f37f7d96a
pkgrel=0
pkgdesc="C11 compiler with C23/C2y/GNU extensions"
url="https://github.com/fuhsnn/slimcc"
arch="x86_64"
license="MIT"
depends="
	binutils
	musl-dev
	slimcc-headers~$pkgver
	"
source="https://github.com/fuhsnn/slimcc/archive/$_gitrev/slimcc-$_gitrev.tar.gz
	abuild-default-cflags.patch
	include-path.patch
	"
builddir="$srcdir/$pkgname-$_gitrev"

prepare() {
	default_prepare

	ln -sv platform/linux-alpine.c platform.c
}

build() {
	make CFLAGS="${CFLAGS//-Os/-O2} -flto=auto"
}

check() {
	make test-all
}

package() {
	install -Dvm755 slimcc -t "$pkgdir"/usr/bin/
	install -Dvm644 LICENSE -t "$pkgdir"/usr/share/licenses/$pkgname/
}

sha512sums="
e9f0e64f3fabeeb05ddc2ec06e7b66c947f1d593c14424c1fa78c361bb2cbb10fa6f6bc3bc0802c00ba0efac58620b3672a19fcf1acd6753803635216163da74  slimcc-764e1d4e51ad51038d71ca17fc9f1a8f37f7d96a.tar.gz
2e74aaa237ed08eedd13ecc9e275d76565c54e42a83499b1f97c05c22534461ac37e806ac6098442e9376f76c176788cd3296b07a1b73cea3c98d8338f72eb8a  abuild-default-cflags.patch
de5f066bbda433c139ddcdea2dc48ad2e621820bb90ddc16a3bb153b3440b305b0d98b6ab15669d3777644763718a9ad46ebdb497d9fdce97228b0dbbe937416  include-path.patch
"
