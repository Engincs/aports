# Contributor: Rasmus Thomsen <oss@cogitri.dev>
# Maintainer: Rasmus Thomsen <oss@cogitri.dev>
pkgname=nuspell
pkgver=5.1.1
pkgrel=0
pkgdesc="Free and open source C++ spell checking library"
url="https://nuspell.github.io/"
arch="all"
license="LGPL-3.0-or-later"
makedepends="cmake icu-dev ronn samurai"
checkdepends="catch2 icu-data-full"
subpackages="$pkgname-dev $pkgname-libs $pkgname-doc"
source="https://github.com/nuspell/nuspell/archive/v$pkgver/nuspell-$pkgver.tar.gz"

build() {
	if [ "$CBUILD" != "$CHOST" ]; then
		CMAKE_CROSSOPTS="-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux"
	fi

	CXXFLAGS="$CXXFLAGS -flto=auto" \
	cmake -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_SHARED_LIBS=True \
		-DCMAKE_BUILD_TYPE=None \
		-DBUILD_TESTING="$(want_check && echo ON || echo OFF)" \
		$CMAKE_CROSSOPTS
	cmake --build build
}

check() {
	CTEST_OUTPUT_ON_FAILURE=TRUE ctest --test-dir build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
c33a52e3603071d3281b7cdcfa42776cd7ecb998292939538e53e364cfff63227cf094cd88ee6072b8a857f5d85c984c359a16b480dd462dac9cfd602cfd6c2c  nuspell-5.1.1.tar.gz
"
