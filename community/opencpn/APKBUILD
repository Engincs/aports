# Contributor: Pedro Filipe <xpecex@outlook.com>
# Contributor: ScrumpyJack <scrumpyjack@st.ilet.to>
# Contributor: omni <omni+alpine@hack.org>
# Maintainer: ScrumpyJack <scrumpyjack@st.ilet.to>
pkgname=opencpn
pkgver=5.12.2
pkgrel=0
pkgdesc="OpenCPN is a cross platform electronic navigation system"
url="https://opencpn.org/"
arch="all"
license="GPL-2.0-or-later AND MIT"
depends="gpsd"
makedepends="
	cmake
	curl-dev
	elfutils-dev
	eudev-dev
	glew-dev
	glu-dev
	jasper-dev
	libarchive-dev
	libexif-dev
	libusb-dev
	linux-headers
	lsb-release
	lz4-dev
	musl-legacy-error
	portaudio-dev
	rapidjson-dev
	samurai
	sqlite-dev
	tinyxml-dev
	wxwidgets-dev
	"
subpackages="$pkgname-doc $pkgname-lang"
source="
	$pkgname-$pkgver.tar.gz::https://github.com/OpenCPN/OpenCPN/archive/refs/tags/Release_$pkgver.tar.gz
	mdns.patch
	rapidjson.patch
	"
builddir="$srcdir/OpenCPN-Release_$pkgver"
options="!check" # todo

build() {
	CXXFLAGS="$CXXFLAGS -flto=auto" \
	cmake3.5 -B build -G Ninja \
		-DCMAKE_BUILD_TYPE=None \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=/usr/lib \
		-DOCPN_BUNDLE_GSHHS=CRUDE \
		-DOCPN_BUNDLE_TCDATA=ON \
		-DOCPN_USE_BUNDLED_LIBS=OFF \
		-DOCPN_BUILD_TEST="$(want_check && echo ON || echo OFF)" \
		-DOCPN_BUNDLE_DOCS=ON
	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
41b9dc8395c9831a23661f74ca98f76f6a3da044c6a3246c1e45dcf33acdaa0bd8277d3826cf535def455ffa8a524c700e3707366927125970a5c0cb4cd4ed9d  opencpn-5.12.2.tar.gz
746dc049985ee2ff14d659fb5ca4ed78932056bc9f4745d49da3eee2c54907c4e9220280a0c3f66f9247d634036cf2da1363cb2018eb873534d2b83d0b84c53f  mdns.patch
1280544c7bce5a164fb43832665064d8a7c28e959de0dd54f84d6419afcba565134d54e2970d8074fd2d6f87cd9cc8fae24912c332167d29e1d13c6a7b7aae5b  rapidjson.patch
"
