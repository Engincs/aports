# Maintainer: Sascha Brawer <sascha@brawer.ch>
pkgname=croaring
pkgver=4.3.11
pkgrel=0
pkgdesc="fast compressed bitmaps in C (and C++)"
url="https://github.com/RoaringBitmap/CRoaring"
arch="all"
license="Apache-2.0 OR MIT"
depends_dev="
	$pkgname=$pkgver-r$pkgrel
	linux-headers
"
makedepends="
	$depends_dev
	cmake
	cmocka-dev
	samurai
"
subpackages="$pkgname-static $pkgname-dev"
source="croaring-$pkgver.tar.gz::https://github.com/RoaringBitmap/CRoaring/archive/refs/tags/v$pkgver.tar.gz"
builddir="$srcdir/CRoaring-$pkgver"

build() {
	cmake -B build-shared -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DCMAKE_BUILD_TYPE=Release \
		-DBUILD_SHARED_LIBS=ON \
		-DROARING_USE_CPM=OFF

	cmake -B build-static -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DCMAKE_BUILD_TYPE=Release \
		-DBUILD_SHARED_LIBS=OFF \
		-DROARING_USE_CPM=OFF

	cmake --build build-shared
	cmake --build build-static
}

check() {
	ctest --test-dir build-shared
	ctest --test-dir build-static
}

package() {
	DESTDIR="$pkgdir" cmake --install build-static
	DESTDIR="$pkgdir" cmake --install build-shared
}

sha512sums="
1de47e732cb7ea38b7c972421efe376a5065d13815b52a0ff3ce193f517a830190a5328209b76b127eaf6a921f338996e3edbaaf87ecac37ae5d4190b17f83bc  croaring-4.3.11.tar.gz
"
