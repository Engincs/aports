# Maintainer: Celeste <cielesti@protonmail.com>
maintainer="Celeste <cielesti@protonmail.com>"
pkgname=riff
pkgver=3.4.1
pkgrel=0
pkgdesc="Diff wrapper that highlights changed portions of lines"
url="https://github.com/walles/riff"
arch="all"
license="MIT"
makedepends="cargo cargo-auditable"
subpackages="$pkgname-doc"
source="https://github.com/walles/riff/archive/refs/tags/$pkgver/riff-$pkgver.tar.gz
	loongarch64-update-tempfile.patch
	"

case "$CARCH" in
loongarch64)
	# rustix fails to build
	options="$options !check"
	;;
esac

prepare() {
	default_prepare

	cargo fetch --target="$CHOST" --locked
}

build() {
	cargo auditable build --frozen --release
}

check() {
	cargo test --frozen
}

package() {
	local targetdir="target/${CARGO_BUILD_TARGET:+$CARGO_BUILD_TARGET/}"

	install -Dvm755 $targetdir/release/riff -t "$pkgdir"/usr/bin/

	install -Dvm644 README.md -t "$pkgdir"/usr/share/doc/$pkgname/
	install -Dvm644 LICENSE -t "$pkgdir"/usr/share/licenses/$pkgname/
}

sha512sums="
b7f6e4965c651dbe01da1d1577ce7f2ccc6230045731b2f92aa513baf733678be9b65db18bc4558dda18fd8b7eea9667c6529f155df972f190ae5450ce2d1241  riff-3.4.1.tar.gz
3d8f4dfbfebf89273cb7ca92328ed3212a86adf2bd66c773ea9e66d840acc7eec3d5f3231de72ac257592a8768dc39e7941c88879bcce42d7af5f07d69eead92  loongarch64-update-tempfile.patch
"
