# Contributor: Matthias Ahouansou <matthias@ahouansou.cz>
maintainer="Matthias Ahouansou <matthias@ahouansou.cz>"
pkgname=scooter
pkgver=0.6.0
pkgrel=0
pkgdesc="Interactive find-and-replace in the terminal"
url="https://github.com/thomasschafer/scooter"
arch="all !riscv64" # tests fail due to having the characters in the input box don't match those expected
license="MIT"
makedepends="cargo-auditable oniguruma-dev"
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::$url/archive/refs/tags/v$pkgver.tar.gz"

export RUSTONIG_DYNAMIC_LIBONIG=1

prepare() {
	default_prepare

	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --frozen --release
}

check() {
	# tests that have a very short timeout, but they are difficult to modify, due to not using a constant
	cargo test --frozen -- \
		--skip test_preview_updates_work_correctly::with_advanced_regex \
		--skip test_preview_updates_work_correctly::without_advanced_regex \
		--skip test_search_and_replace_regex_capture_group::with_advanced_regex \
		--skip test_search_and_replace_regex_capture_group::without_advanced_regex \
		--skip test_search_and_replace_advanced_regex_negative_lookahead
}

package() {
	install -Dm755 "target/release/$pkgname" -t "$pkgdir/usr/bin"
	install -Dm644 "LICENSE" "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}

sha512sums="
70b08644e2379fd3b928eeba8324409a1cae4c1ba13d08869b6df758cfa011895db3af065467c51fce4f3bf05900ce492be903a8ff997cf7971f96ddfcf98985  scooter-0.6.0.tar.gz
"
