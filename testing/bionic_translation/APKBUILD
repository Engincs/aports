maintainer="Bart Ribbers <bribbers@disroot.org>"
pkgname=bionic_translation
pkgver=0_git20251004
pkgrel=0
_commit="0d41c7f52a8c09d672dddf1a7bf5d8419492ecb3"
pkgdesc="A set of libraries for loading bionic-linked .so files on musl/glibc"
url="https://gitlab.com/android_translation_layer/bionic_translation"
arch="x86_64 aarch64 !armv7 x86"
license="Apache-2.0"
makedepends="
	elfutils-dev
	libbsd-dev
	libunwind-dev
	mesa-dev
	meson
	samurai
	"
checkdepends="bubblewrap"
subpackages="$pkgname-dev $pkgname-dbg"
source="https://gitlab.com/android_translation_layer/bionic_translation/-/archive/$_commit/bionic_translation-$_commit.tar.gz"
options="!check" # Tests require bubblewrap which can not run in CI/containerized environments
builddir="$srcdir/bionic_translation-$_commit"

build() {
	abuild-meson \
		. output
	meson compile -C output
}

check() {
	meson test --print-errorlogs -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output
}

sha512sums="
6e33ffdb1bd4cd3082f101e48ca82eec2186deb5361715c89a96304600e23cdc6e77b0db5a4a1e62ecdabbae64e24bb919b3192e14839cd102c5b8d1ea3c52a4  bionic_translation-0d41c7f52a8c09d672dddf1a7bf5d8419492ecb3.tar.gz
"
