# Contributor: Guy Godfroy <guy.godfroy@gugod.fr>
# Maintainer: Guy Godfroy <guy.godfroy@gugod.fr>
pkgname=nitro-init
_pkgname=nitro
pkgver=0.4.1
pkgrel=0
pkgdesc="Tiny but flexible init system and process supervisor"
url="https://git.vuxu.org/nitro/"
arch="all"
license="0BSD"
subpackages="$pkgname-doc"
source="$_pkgname-$pkgver.tar.gz::https://git.vuxu.org/nitro/snapshot/nitro-$pkgver.tar.gz
	01-race-condition.patch
	"
builddir="$srcdir/$_pkgname-$pkgver/"
checkdepends="reap ruby"

build() {
	make
}

check() {
	make check
}

package() {
	install -Dm755 nitro "$pkgdir"/usr/sbin/nitro
	install -Dm755 nitroctl "$pkgdir"/usr/bin/nitroctl
	install -Dm644 nitroctl.1 -t "$pkgdir"/usr/share/man/man1/
	install -Dm644 nitro.8 -t "$pkgdir"/usr/share/man/man8/
	install -Dm644 halt.8 -t "$pkgdir"/usr/share/man/man8/
}

sha512sums="
c0e046bfb331c9722f4fac523b05b6b36b29499e7186c6a27b104ae7f87af7be56b61cdc32cc87b7543f92446dc2e659e0b986b34946be9dd4f707900cc84abc  nitro-0.4.1.tar.gz
12a9835889da5362a56b2165fe8f14437b6796850871d501fa8c85a101a0ff01ca08a64c601308ccdc4208961abd658e0481a50c136677c68b8eacb06b1e35cc  01-race-condition.patch
"
