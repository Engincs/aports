# Contributor: Zach DeCook <zachdecook@librem.one>
maintainer="Krystian Chachu≈Ça <krystian@krystianch.com>"
pkgname=rpicam-apps
pkgver=1.9.0
pkgrel=0
pkgdesc="Suite of libcamera-based applications to drive the Raspberry Pi cameras"
url="https://github.com/raspberrypi/rpicam-apps"
arch="aarch64 armhf armv7" # libcamera by default only includes rpi/vc4 pipeline on these archs
license="BSD-2-Clause"
depends="libcamera-raspberrypi"
makedepends="
	boost-dev
	ffmpeg7-dev
	libcamera-dev
	libdrm-dev
	libexif-dev
	libjpeg-turbo-dev
	libpng-dev
	meson
	musl-dev
	tiff-dev
"
subpackages="$pkgname-doc"
source="
	https://github.com/raspberrypi/rpicam-apps/archive/v$pkgver/rpicam-apps-v$pkgver.tar.gz
	"

build() {
	abuild-meson \
		-Denable_libav=enabled \
		-Denable_drm=enabled \
		-Denable_egl=disabled \
		-Denable_qt=disabled \
		-Denable_opencv=disabled \
		-Denable_tflite=disabled \
		-Dneon_flags=auto \
		-Denable_hailo=disabled \
		-Ddownload_hailo_models=false \
		build .
	meson compile -C build
}

check() {
	meson test --print-errorlogs -C build
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C build
	install -Dm644 license.txt "$pkgdir"/usr/share/licenses/$pkgname/license.txt
}

sha512sums="
848cbfe14b4d620ad1eaa7d9e5ef7c8609d27c2b81e491a7909202545d8a5174d0d4888d9fc460e3cededcc44013d9b5fd8c6a4580245e1386e12eb3f3db69e4  rpicam-apps-v1.9.0.tar.gz
"
