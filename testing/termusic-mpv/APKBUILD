# Contributor: Coco Liliace <coco@liliace.dev>
# Maintainer: Coco Liliace <coco@liliace.dev>
#
# optional dependencies:
# - yt-dlp and ffmpeg: for downloading from youtube
pkgname=termusic-mpv
pkgver=0.11.0
pkgrel=0
pkgdesc="Music Player TUI written in Rust"
url="https://github.com/tramhao/termusic"
arch="all"
license="MIT AND GPL-3.0-or-later"
depends="protoc mpv-dev"
makedepends="cargo cargo-auditable dbus-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/tramhao/termusic/archive/refs/tags/v$pkgver.tar.gz"
builddir="$srcdir/termusic-$pkgver"

prepare() {
	default_prepare

	cargo fetch --locked --target="$CTARGET"
}

check() {
	cargo test --features cover,mpv --release --all
}

build() {
	cargo auditable build --no-default-features --features cover,mpv --release --frozen --all
}

package() {
	install -Dm755 -t "$pkgdir"/usr/bin ./target/release/termusic ./target/release/termusic-server
}
sha512sums="
da9e6b00d0bd26f85bca867aefc72d804255048d1f18de7538f814b41ea262e0ab93fc0ded1bf836ff96e93cf690b8d583629c8eb52742cb6095abf57211927c  termusic-mpv-0.11.0.tar.gz
"
