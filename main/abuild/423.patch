From 721efd55d41d1f575c8fbf7a67d2c72ae57cb178 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Pablo=20Correa=20G=C3=B3mez?=
 <pabloyoyoista@postmarketos.org>
Date: Mon, 28 Jul 2025 13:09:54 +0200
Subject: [PATCH] abuild: bootstrap rootbld /usr merged for supported alpine
 versions

Relates https://gitlab.alpinelinux.org/alpine/aports/-/merge_requests/85504
---
 abuild.in | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/abuild.in b/abuild.in
index cc93c202..cc236656 100644
--- a/abuild.in
+++ b/abuild.in
@@ -2598,6 +2598,14 @@ rootbld() {
 	) < "$repo_template" > "$BUILD_ROOT/etc/apk/repositories"
 
 	calcdeps
+
+	case "$version" in
+		edge|v3.2[3-6])
+			mkdir -p "$BUILD_ROOT"/usr/lib "$BUILD_ROOT"/usr/bin "$BUILD_ROOT"/usr/sbin
+			ln -s usr/bin usr/sbin usr/lib "$BUILD_ROOT"/
+			;;
+	esac
+
 	$SUDO_APK add --initdb --update \
 		--no-interactive \
 		--arch $CBUILD_ARCH \
-- 
GitLab

