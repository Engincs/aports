From 8c9435f26dc2e2a9d73ac91b9c3fcbb76381062e Mon Sep 17 00:00:00 2001
From: Sertonix <sertonix@posteo.net>
Date: Tue, 14 Oct 2025 17:36:12 +0200
Subject: [PATCH 1/2] abuild: fix depends_dev check for versioned pc
 dependencies

Fixes build of community/tinysparql
---
 abuild.in | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/abuild.in b/abuild.in
index d99b3fe7..9f614f84 100644
--- a/abuild.in
+++ b/abuild.in
@@ -1540,7 +1540,7 @@ trace_apk_deps() {
 		if subpkg_provides_pc "$pcprefix$i"; then
 			autodeps="$autodeps pc:$pcprefix$i"
 		elif $APK $apkroot info --quiet -e "pc:$i"; then
-			provider=$($APK $apkroot search --from installed --quiet --exact "pc:$i")
+			provider=$($APK $apkroot search --from installed --quiet --exact "pc:${i%%[<>=~]*}")
 			if list_has "$provider" $depends_dev; then
 				warning "$provider should be removed from depends_dev"
 			fi
-- 
GitLab


From 1e7c10a1d37524e5904d21b88576fbcaf6ab2f18 Mon Sep 17 00:00:00 2001
From: Sertonix <sertonix@posteo.net>
Date: Tue, 14 Oct 2025 17:46:47 +0200
Subject: [PATCH 2/2] tests: speed up test-size-many

Otherwise it causes a timeout too often
---
 tests/abuild_test | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/tests/abuild_test b/tests/abuild_test
index 3543f371..362a0d33 100755
--- a/tests/abuild_test
+++ b/tests/abuild_test
@@ -734,7 +734,7 @@ abuild_package_size_body() {
 
 		_many() {
 			mkdir -p "\$subpkgdir"
-			for i in \$(seq 10000); do
+			for i in \$(seq 1000); do
 				printf '\\n' > "\$subpkgdir/\$i"
 			done
 		}
@@ -773,7 +773,7 @@ abuild_package_size_body() {
 		empty-trigger:1 \
 		dirs:1 \
 		files:39 \
-		many:10000 \
+		many:1000 \
 		holes:65535 \
 		hardlink:5 \
 		symlink:1 \
-- 
GitLab

