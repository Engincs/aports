# Co-Maintainer: Pablo Correa Gomez <pabloyoyoista@postmarketos.org>
# Maintainer: Clayton Craft <clayton@craftyguy.net>
pkgname=merge-usr
pkgver=1.0.1
pkgrel=0
pkgdesc="Script to produce a merged-usr system"
url="https://gitlab.alpinelinux.org/postmarketos/merge-usr"
arch="all"
license="GPL-2.0-or-later"
# A lot of LSMs use xattrs for their metadata.
# Make sure that metadata is preserved.
depends="attr"
checkdepends="bubblewrap"
source="https://gitlab.alpinelinux.org/postmarketos/merge-usr/-/archive/$pkgver/merge-usr-$pkgver.tar.gz"
# Tests need unprivileged user namespaces
options="!check"

build() {
	make all
}

check() {
	make test
}

package() {
	DESTDIR="$pkgdir" make install
}
sha512sums="
3dd443e57de33f0b03e0aece2048d2a67977299f64eb642d5762e117cba8c5edb4db6bfbdd984d63c02cbecfa41db9bdb8598ecfff8a7c0638b9a34cb9678d88  merge-usr-1.0.1.tar.gz
"
